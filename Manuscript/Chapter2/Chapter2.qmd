---
title: Multispectral and hyperspectral classification of intertidal vegetation using a spectral library for coastal biodiversity remote sensing
number-sections: true
---

```{r pack}
#| include: false
#| message: false
#| warning: false
#| error: false

# library(officedown) 
# library(officer) 
library(flextable)
library(tidyverse)

options(scipen=9999999) 
```

```{=latex}
\begin{center} 
\includegraphics[width=5cm]{LogoRSE.jpg}
\end{center}

This chapter was published in Remote Sensing of Environment on May 15, 2023. The first author of this work is Bede Davies, a postdoctoral researcher in the lab throughout my entire thesis. He was responsible for developing a neural network classifier for Sentinel-2 products, designed to distinguish seagrasses from green macrophytes. This chapter marks the beginning of that work—a proof of concept demonstrating the impact of sensor spectral resolution on vegetation discrimination.
The research began in 2021 as part of the BiCOME project, when I was working as an engineer in the lab. During that time, I supervised a Master's student, Andréa Geraud, during his second-year internship, focusing on the acquisition and processing of data used in this study. This work was later continued by Bede Davies.

\vspace{0.5cm}

\noindent
\makebox[\textwidth][l]{Davies, B. F. R., Gernez, P., Geraud, A., Oiry, S., Rosa, P., Zoffoli, M. L., \& Barillé, L. (2023).}
\hspace*{2em}\begin{minipage}{0.9\textwidth}
Multi-and hyperspectral classification of soft-bottom intertidal vegetation using a spectral library for coastal biodiversity remote sensing. \textit{Remote Sensing of Environment, 290,} 113554.
\end{minipage}

```

## Abstract {.unnumbered}

Monitoring biodiversity and how anthropogenic pressures impact this is critical, especially as anthropogenically driven climate change continues to affect all ecosystems. Intertidal areas are exposed to particularly high levels of pressures owing to increased population density in coastal areas. Traditional methods of monitoring intertidal areas do not provide datasets with full coverage in a cost-effective or timely manner, and so the use of remote sensing to monitor these areas is becoming more common. Monitoring of ecologically important monospecific habitats, such as seagrass beds, using remote sensing techniques is well documented. However, the ability for multispectral data to distinguish efficiently and accurately between classes of vegetation with similar pigment composition, such as seagrass and green algae, has proved difficult, often requiring hyperspectral data. A machine learning approach was used to differentiate between soft-bottom intertidal vegetation classes when exposed at low tide, comparing 6 different multi- and hyperspectral remote and in situ sensors. For the library of 366 spectra, collected across Northern Europe, high accuracy (>80%) was found across all spectral resolutions. While a higher spectral resolution resulted in higher accuracy, there was no discernible increase in accuracy above 10 spectral bands (95%: Sentinel-2 MSI sensor with a spatial resolution of 20 m). This work highlights the ability of multispectral sensors to discriminate intertidal vegetation types, while also showing the most important wavelengths for this discrimination (530 and 730 nm), giving recommendations for spectral ranges of future satellite missions. The ability for multispectral sensors to aid in accurate and rapid intertidal vegetation classification at the taxonomic resolution of classes, could be a significant contribution for future sustainable and effective ecosystem management.

```{=latex}
\begin{spacing}{1.5}
\startonrightwithgap
```


## Introduction

Soft-bottom intertidal ecosystems support a diversity of habitats (seagrass meadows, honeycomb worm reefs, oyster reefs, mudflats) and biological communities worldwide [@Mouritsen2002; @VanDerMaarel2003; @Murray2019]. The richness and diversity these habitats contain help to provide numerous ecosystem services, such as protection against coastal erosion, carbon regulation, oxygen production, seasonal habitat for migratory birds [@zoffoli2023remote], and reserves and nurseries for fisheries [@gardner2018global]. However, the significant roles of intertidal areas for biodiversity and the ecosystem services they provide are not universally known [@unsworth2019seagrass;@unsworth2019global;@Unsworth2022;@Reddin2022]. Like the majority of coastal ecosystems worldwide, intertidal areas are exposed and vulnerable to anthropogenic pressures, particularly more so due to their closer proximity to potentially destructive human activity [@Murray2019;@green2021historical]. Global warming, sea-level rise and the rising frequency of extreme climatic events lead to a reduction of their surface [@Masson2021], and to a diminution of their capability to recover from perturbations [@Schiel2021]. The effects of climate change impact intertidal habitats inconsistently; declines of certain species and the proliferation of others [@Bryndum2019]. Intertidal areas are also directly degraded by human activities, such as coastal urbanization [@Momota2021], use of various biochemical contaminants [@Durou2007; @Hope2021], eutrophication [@Cardoso2004], land reclamation [@Sedano2021], and shellfish farming [@Garmendia2021]. These pressures impact intertidal biodiversity [@Beltrand2022] and the ecosystem services it provides [@gardner2018global; @Brondizio2019].

To reduce these impacts and improve the protection of intertidal areas, several measures have been implemented over the past decades in Europe, such as the WFD [@Directive2001], and the Marine Strategy Framework Directive MSFD [@Directive2008]. However, according to the Intergovernmental Science-Policy Platform on Biodiversity and Ecosystem Services [IPBES, @Brondizio2019], current efforts are insufficient to reach the objectives of ecosystem conservation and sustainable exploitation. The ecological status of many intertidal areas have never been evaluated, with many areas uncharacterised. Even in documented areas, there are many socio-environmental challenges to implementing efficient protection and sustainable exploitation [@unsworth2019seagrass]. Providing updated and accurate maps of intertidal areas is a prerequisite to addressing such challenges [@mckenzie2020global]. However, the traditional methods for mapping rely on field surveys to estimate species abundance, biomass and habitat surface, which are time-consuming and labor-intensive [@nijland2019; @olmedo2020far]. The collected data are also limited by sampling constraints, as many intertidal areas are difficult to access. Remote sensing can overcome these issues by acquiring temporally and spatially resolved observations of coastal areas [@Papathanasopoulou2019; @Veettil2020]. Likewise, the use of drones can increase the surveyed area compared to traditional survey methods while providing greater spatial resolution and flexibility than satellite imagery [@Gomes2018].

Marine vegetation, defined as any species of plant that, at any time in its life, must inhabit water, other than freshwater, includes a wide range of highly important intertidal species, such as seagrasses, mangroves and marine algae. In the visible and near-infrared range (VNIR), exposed intertidal vegetation can be identified by its spectral reflectance [@olmedo2020far; @douay2022new]. Solar irradiance is absorbed by plant pigments in the visible spectral range [400 to 700 nm: @Hallik2017], while in the NIR range (700 to 900 nm), light is reflected by tissues in pluricellular organisms [@ustin2020optical], and by the sediment background for biofilms composed of unicellular photoautotrophs [@Barille2011]. The spectral signature or lack thereof can be used as a marker of the different classes of organisms [@Thorhaug2007]. Reflectance is increasingly being used to measure EBVs in coastal ecosystems, such as species traits or ecosystem structure and function [@pereira2013essential; @Muller-Karger2018]. Time-series derived from satellite observations also make it possible to study changes in biodiversity metrics and environmental drivers over decades, as demonstrated recently for the monitoring of seagrass status [@zoffoli2021decadal;@Lizcano2022], or macroalgae invasions [@Hu2017; @Santos2020]. Most satellite sensors are multispectral [@Joyce2009; @Xue2017], and generally measure the reflectance using three to ten spectral bands in the VNIR spectral domain. Depending on the band numbers and characteristics, the discrimination of different types of marine vegetation can be limited [@Kutser2006; @Casal2013]. Hyperspectral missions such as PRISMA, or EnMAP acquiring data along a large number of narrow spectral bands could improve habitat identification accuracy [@Ustin2004; @Hestir2015]. However, these sensors often provide relatively low spatial and temporal resolutions [@Veettil2020], can contain high levels of noise per spectral band, and are not openly available resources (e.g. PRISMA imagery: 30 m pixel size, 29 day orbit repeat cycle and are only available on prior request or EnMAP imagery: 30 m pixel size and a 27 day orbit repeat cycle). 

Mapping intertidal habitats of ecological importance, such as seagrass beds, can be achieved with a multispectral resolution in the case of exposed monospecific meadows observed during low tide [@zoffoli2020sentinel;@zoffoli2023remote]. However, when seagrass are mixed with other green vegetation, discrimination with multi- or even hyperspectral sensors (*in situ* and satellite) is challenging [@Phinn2018;@Veettil2020]. Green macroalgae and more specifically the taxonomic class of Ulvophyceae share the same pigmentary composition with seagrass and should be *a priori* more complex to discriminate [@oiry2021using]. Other taxonomic classes common in intertidal soft-bottom environments such as Xanthophyceae and Bacillariophyceae could also be confused with seagrass when present at low cover [@zoffoli2020sentinel]. It is generally agreed that the identification at broad taxonomic levels (eg. class level) is more precise than at the species level [@Kutser2006;@Casal2013]. Assessing the ability of a sensor to discriminate seagrass meadows from other intertidal vegetation can be explored with spectral libraries. They have been used to study the spectral discrimination between macroalgal species [@Casal2013; @Dierssen2015; @ChaoRodriguez2017; @rs11060704; @olmedo2020far; @douay2022new], and to identify different seagrass species [@fyfe2003spatial] or to differentiate seagrass from other nearshore vegetation types [@legare2022remote]. By applying to *in situ* spectra collected with a spectroradiometer the spectral responses function of multi- and hyperspectral sensors, it is possible to investigate their abilities to classify intertidal green macrophytes. In particular, the possibility to discriminate seagrass from green macroalgae at a multispectral resolution remains to be studied using machine learning (ML) approaches.

This study aimed at analysing the potential of multi- and hyperspectral satellite missions (Pleiades, Sentinel-2, and PRISMA), as well as a multispectral drone sensor, for the discrimination of green macrophytes from low tide soft-bottom intertidal areas when exposed using RS. A spectral library of the spectral signatures of seagrass, green macroalgae, and other intertidal vegetation was compiled from measurements performed with a field spectroradiometer. This library represents a novel taxonomic and spatial coverage with spectra from a wide array of exposed soft-bottom intertidal habitats collected across almost 15 degrees of latitude. High-resolution spectra were degraded to each sensor spectral resolution. A combination of multivariate and ML algorithms was then performed to compare the ability of the different spectral resolution data at distinguishing the main taxonomic classes of intertidal vegetation. The wavelengths which best discriminated green macrophytes were identified and recommendations given on potential future satellite sensors. 

## Materials and Methods

### Spectral Reflectance Acquisition

Spectral reflectance data were collected from a range of macroalgal, microphytobenthic and seagrass dominated soft-bottom intertidal areas. Samples were grouped at the class level: Magnoliopsida (Seagrasses), Ulvophyceae (Green Macroalgae), Phaeophyceae (Brown Macroalgae), Xanthophyceae (Yellow Algae) and Bacillariophyceae (Diatoms: @tbl-SPECIESTABLE & @fig-Images). Brown macroalgae growing on rocky substrates were added as they are often found stranded in the intertidal zone. Spectral reflectance were also recorded from sediment areas without clear vegetation, hereafter referred to as "bare sediment" for the sake of simplicity. Scientific names and taxonomy were based on the World Register of Marine Species (WORMS). Species were identified *in situ* when recently exposed but not covered by a layer of water.

```{r SpeciesTable}
#| label: tbl-SPECIESTABLE
#| tbl-cap: Number of spectra samples taken across species and classes with references of where and when the data were collected. Mont Saint-Michel Bay was abbreviated to MSM. The location of sampling sites are shown in @fig-FIGMAP. 
#| echo: false
#| error: false
#| message: false
#| warning: false
#| out-width: "95%"


library(tidyverse)

Table<-tibble(
  Class=c("Magnoliopsida","Magnoliopsida","Ulvophyceae","Ulvophyceae","Ulvophyceae",
          "Ulvophyceae","Ulvophyceae","Ulvophyceae","Ulvophyceae","Xanthophyceae",
          "Phaeophyceae","Phaeophyceae","Phaeophyceae","Phaeophyceae",
          "Phaeophyceae","Bacillariophyceae","Bacillariophyceae",
          "Bacillariophyceae"),
  Species=c("Zostera noltei","Zostera marina","Ulva sp.","Ulva ramulosa",
          "Ulva linza","Chaetomorpha sp.","Cladophora sp.","Ulva lactuca",
          "Codium fragile","Vaucheria sp.","Fucus vesiculosus",
          "Fucus serratus","Fucus spiralis","Ascophyllum nodosum",
          "Rugulopteryx okamurae","Navicula ramosissima",
          "Entonomeis paludosa","Gyrosigma limosum"),
 `Number of Spectra`=c(58,23,
                       16,3,33,21,11,34,3,
                       33,
                       27,6,13,13,5,
                       10,21,2),
 Site=c("Bourgneuf Bay, Marennes-Oléron Bay, Cadiz Bay, Tagus Estuary, Aveiro Lagoon and Traict of Merquel",
        "Bourgneuf Bay", 
        "Bourgneuf Bay, Auray Estuary, MSM, Tagus Estuary, Aveiro Lagoon and Traict of Merquel",
        "Bourgneuf Bay", 
        "Traict of Merquel",
        "Morbihan Gulf",
        "Morbihan Gulf",
        "Morbihan Gulf",
        "Morbihan Gulf",
        "Bourgneuf Bay",
        "MSM, Bourgneuf Bay, Morbihan Gulf, Tagus Estuary and Aveiro Lagoon",
        "MSM",
        "Morbihan Gulf",
        "MSM, Auray Estuary, Morbihan Gulf",
        "Bolonia Beach",
        "Bourgneuf Bay",
        "Bourgneuf Bay",
        "Bourgneuf Bay"),	
 Reference=c("Zoffoli et al., 2020 and
             this study",
    "This study",
    "Barillé et al., 2010 and
    this study",
    "This study",
    "This study",
    "This study",
    "This study",
    "This study",
    "This study",
    "This study",
    "This study",
    "This study",
    "This study",
    "This study",
    "Roca et al., 2022",
    "Barillé et al., 2011",
    "Barillé et al., 2011",
    "Barillé et al., 2011") )  



SPECIESTABLE_Cap<-" Number of Spectra samples taken per habitat type."
# 
# NSamples<-datatransformed_Wide[[1]] %>% 
#   group_by(Species_Group) %>% 
#   summarise(count(.) ) %>% 
#   distinct() %>% 
#   dplyr::rename(Habitat=Species_Group,
#                 `No. of Spectra`=n) 

flxtbl <- Table %>% 
  flextable::as_grouped_data(groups = "Class") %>% 
  flextable::flextable() %>% 
  # flextable::fontsize(size = 18, part = "header") %>% 
  # flextable::fontsize(size = 15) %>% 
  flextable::italic(j = 2, italic = TRUE) %>% 
  flextable::align(align = "center", part = "body") %>%    # Center text in body cells
  flextable::align(align = "center", part = "header") %>%  # Center text in header cells
  flextable::width(j = c("Site"), width = 3) # Set narrower columns
  # flextable::autofit() %>% 
  # flextable::set_table_properties(width = 1, layout = "autofit")

# Display the flextable
# flextable::save_as_image(flxtbl, path = "Manuscript/Chapter2/Figs/SPECIESTABLE.png")
# flxtbl
knitr::include_graphics("Figs/SPECIESTABLE.png")
```

```{r Images}
#| label: fig-Images
#| fig-cap: " Examples of taxonomic classes of soft-bottom intertidal vegetation in the field (a: Phaeophyceae (*Fucus vesiculosus*), b: Magnoliopsida (*Zostera noltei*), c: Ulvophyceae (*Ulva linza*), d: Bacillariophyceae (Diatoms) and e: Xanthophyceae (*Vaucheria* spp.)). Scale bars show approximate scale."
#| fig.width: 10
#| fig.height: 6.37
#| error: false
#| warning: false
#| echo: false  

knitr::include_graphics("Figs/Figure1.jpg")

```

Multiple field campaigns taking place from 2 hours prior to 2 hours post minimum tide were carried out across temperate intertidal areas along the Western Atlantic coastline during the summer months (@fig-FIGMAP). The campaigns took place in France in Bourgneuf Bay [@Barille2010; @Barille2011; @zoffoli2020sentinel], Marennes-Oléron Bay, Auray Estuary, Mont-Saint-Michel Bay, Morbihan Gulf and Traict of Merquel, in Spain in Bolonia Beach [@roca2022monitoring] and Bay of Cadiz [@zoffoli2020sentinel], and in Portugal in the Tagus Estuary and Aveiro Lagoon. 

```{r FIGMAP}
#| label: fig-FIGMAP
#| fig-cap: "Sample collection sites across Europe."
#| fig.width: 10
#| fig.height: 9.2
#| out-width: "95%"
#| error: false
#| warning: false
#| echo: false

knitr::include_graphics("Figs/Figure2_Bede.jpg")

```

### Data Analysis

#### Spectral Degradation

The efficacy, efficiency and ability of classifying intertidal soft-bottom vegetation were assessed for a variety of remote-sensing sensors, including two multispectral satellite sensors (the high-resolution imager (HiRI) onboard Pleiades and the multi-spectral instrument (MSI) onboard Sentinel-2), one hyperspectral satellite sensor (the hyperspectral camera (HYC) onboard PRISMA satellite) and one airborne multispectral sensor (MicaSense RedEdge MX-dual Sensor on board a DJI Matrice 200 drone). These sensors cover a gradient of spectral resolution from multispectral to hyperspectral (@fig-SpectraDegFIG). The spectral response functions of Pleiades and Sentinel-2 were used to degrade the hyperspectral library to the respective resolution of each sensor. The highest spatial resolution of Sentinel-2 (10 m) consists of 4 spectral bands while the 20 m sensor has 4 additional bands in the VNIR spectral range (total 8 bands). Sentinel-2 spectral bands, such as at 443 nm, were not used because its spatial resolution (60 m) is too coarse for intertidal seagrass mapping [@zoffoli2020sentinel]. To degrade the ASD library to the PRISMA spectral resolution, only central wavelengths and bandwidths (from 400 to 900 nm) were obtained from the Agenzia Spaziale Italiana [@ASI2020]. Likewise, central wavelengths with bandwidths were available for the Micasense ("Drone" henceforth). Therefore, the mean of the reflectance values included in the bandwidth of each PRISMA and Drone function band were computed. Across all sensors, a moving average was applied to the ASD spectral library with a 5 nm smoothing window to reduce instrument-induced noise in the data.

```{r SpectralDegradationPlot}
#| label: fig-SpectraDegFIG
#| fig-cap: " Spectral response functions for different hyper- and multi-spectral sensors (ASD, Pleiades, Sentinel-2 (10 m), Sentinel-2 (20 m), Drone, and PRISMA)."
#| fig.width: 9.833749
#| fig.height: 10
#| out-width: "95%"
#| error: false
#| warning: false
#| echo: false

knitr::include_graphics("Figs/Figure3_Bede.jpg")

```

#### Standardisation 

All spectra were standardised to reduce the effect of variable biomass, density or thickness of sample, with a Min-Max transformation [@Cao2017].  This calculation emphasised the spectral shapes in the visible range associated with the pigment composition [@douay2022new]:  

$$ R_{i}^*(\lambda) = \frac{R_{i}(\lambda)-min(R_{i}) }{max(R_{i})-min(R_{i}) }$${#eq-stdspectra}

where $R_{i}(\lambda)$ is the reflectance at a specific wavelength ($\lambda$) for a specific spectrum (i), where min($R_{i}$) and max($R_{i}$) are the corresponding minimum and maximum values. 


#### Statistical Analysis 

To visually assess the differences between classes across different spectral resolutions dissimilarity matrices were computed for all vegetative classes, with the cosine distance to compute a Spectral Angle Mapper (SAM). The SAM algorithm considers that each spectrum is a vector in $n$-dimensions space, $n$ being the number of bands, and measures the angle between two spectra to determine their dissimilarity [@Kruse1993]. The difference between classes were visualised and statistically assessed with non-metric Multi-Dimensional Scaling (nMDS) ordination and Analysis of Similarity (ANOSIM) from the 'vegan' package within the programming language R [@R-vegan]. ANOSIM was carried out on the SAM distance matrix using 999 permutations.

To assess the ability of different sensors at classifying intertidal vegetative and non vegetative classes (bare sediments, Bacillariophyceae, Magnoliopsida, Phaeophyceae, Ulvophyceae & Xanthophyceae) from their spectral reflectance data, supervised Machine Learning (ML)  algorithms were applied from the "tidymodels" ecosystem of packages within the programming language R [@Rtidymodels;@Rbase]. Multiple models were developed (Random Forest, XGBoost and Multinomial Classifiers) with relatively similar results. The model described here was an ensemble decision tree classification approach; Random Forest from the "ranger" package [@R-ranger]. As Random Forest employs randomisation of trees, 20 repetitions of the analysis were carried out to avoid over or under representation of specific samples. Spectral data were split into training and testing sets using a proportion of 0.75 to 0.25 using the response variable to stratify samples and reduce group imbalance. Training data were then further split into 30 training and validation datasets using bootstrap resamples to allow hyper-parameter tuning from the "rsample" package [@R-rsample]. Class was modelled as a function of all available features (standardised reflectance of each wavelength), where all features displaying zero variance across all classes were removed before model tuning as zero variance values would provide no additional information for the models. This meant only the first three bands of Pleiades and Sentinel-2 at 10 m were evaluated as their highest bands in the NIR showed no variance. Models were tuned to maximise the Area Under the Curve of the Receiver Operating Characteristic (ROC), which measures the diagnostic ability of a classifier based on the ratio of false positive and true positive rate. Accuracy, Cohen's kappa (an accuracy measure that takes into account class size discrepancy), sensitivity and specificity were calculated using the 'yardstick' package, while the 'vip' package was used to calculated variable importance [@R-yardstick;@R-vip]. Variable importance will show the relative importance of different wavelengths and was calculated by the prediction error, using permuted out-of-bag data and comparing differences to the prediction error of permuted predictor variables.

## Results

### Spectral Signatures at Different Spectral Resolutions

At hyperspectral resolution (ASD, PRISMA), the differences among vegetative habitats were obvious, with the highest dissimilarities observed from 550 – 650 nm and from 700 – 850 nm (@fig-SpectraFIG). In particular, the spectral characteristics among the classes were more conspicuous in the green - red spectral range, such as reflectance peaks at 550 nm (Magnoliopsida, Ulvophyceae, Xanthophyceae), 600 nm (Bacillariophyceae), and 650 nm (Xanthophyceae and Bacillariophyceae). The absorption band at 675 nm, present in every class, corresponded to Chla while at 630 nm a smaller absorption band for the Bacillariophyceae and the Xanthophyceae corresponded to Chlorophyll-c (Chlc). Phaeophyceae was the class showing the lowest reflectance in the visible range. All classes but the Ulvophyceae had a positive slope in the NIR. The degradation to a multispectral resolution made these spectral features harder and or impossible to distinguish. The differences between vegetation classes were more pronounced for the drone and Sentinel-2 20 m sensors (8 - 10 spectral bands) than for the Pleiades and Sentinel-2 10 m sensors (4 spectral bands). 

```{r SpectralPlotswithBS}
#| label: fig-SpectraFIG
#| fig-cap: " Spectral signatures of different vegetation classes at different spectral resolutions (ASD, Pleiades, Sentinel-2 10, Sentinel-2 10-20 m, Drone and PRISMA). Lines show mean signature per wavelength, while shading shows 95% confidence interval. Confidence intervals were consisently small and therefore are hard to distinguish."
#| fig.width: 9.86
#| fig.height: 10
#| out-width: "95%"
#| error: false
#| warning: false
#| echo: false

knitr::include_graphics("Figs/Figure4_Bede.jpg")
```

### Spectral Dissimilarity Between the Taxonomic Classes

The nMDS ordinations calculated with a cosine distance showed that all vegetation classes could be distinguished with a hyperspectral sensor (ASD, PRISMA), despite some overlaps between the Magnioliopsida, Ulvophyceae and Xanthophyceae (@fig-MDSFIG). Interestingly, similar ordination patterns were also observed for the multispectral sensors with the highest number of bands (i.e., Drone, Sentinel-2 20 m). The greatest dissimilarity between classes was observed for the ASD (R = 0.638 & p = 0.001). The differences between PRISMA, the Drone and Sentinel-2 at 20 m were very similar (PRISMA: R = 0.611 & p = 0.001, Drone: R = 0.588 & p = 0.001 & Sentinel-2 at 20 m), while Pleiades and Sentinel-2 at 10 m were far lower (Pleiades: R = 0.49 & p = 0.001 & Sentinel-2 at 10 m). Strong overlaps were observed between the classes Magnioliopsida and Ulvophyceae at the low spectral resolution of Pleiades and Sentinel-2 10 m.

```{r MDSPlotsWithoutBS}
#| label: fig-MDSFIG
#| fig-cap: " nMDS ordination showing similarities between vegetation classes at different spectral resolutions (ASD, Pleiades, Sentinel-2 10, Sentinel-2 10-20 m, Drone and PRISMA). Point distances are based on cosine distance, polygons show the minimum convex hull to surround all points. Stress values show the inaccuracy of the 2 dimensional representations."
#| fig.width: 9.89
#| fig.height: 10
#| out-width: "95%"
#| error: false
#| warning: false
#| echo: false

knitr::include_graphics("Figs/Figure5_Bede.jpg")

```

### Accuracy Across Sensors and Importance of Wavelengths 

When assessed by Random Forest modelling, accuracy metrics of different spectral resolutions showed that Sentinel-2 20 m and Drone spectra gave high mean accuracy regardless of accuracy metric (Accuracy: 0.95 ± 0.004 for Sentinel-2 20 m & 0.948 ± 0.004 for Drone. Cohen’s Kappa Accuracy: 0.935 ± 0.006 for Sentinel-2 20 m & 0.934 ± 0.005 for Drone: @fig-MetricsFIG & @tbl-metricsTable). Above a spectral resolution of 10 bands, there was no gain in mean accuracy even with large increases in spectral resolution (Accuracy: 0.95 ± 0.005 for ASD & 0.951 ± 0.006 for PRISMA. Cohen’s Kappa Accuracy: 0.936 ± 0.006 for ASD & 0.938 ± 0.008 for PRISMA). The sensors with the lowest spectral resolution (Pleiades and Sentinel-2 10 m) showed the lowest accuracy, yet still were accurate around 80 to 90% of the time (Accuracy: 0.861 ± 0.006 for Pleiades & 0.835 ± 0.008 for Sentinel-2 10 m. Cohen’s Kappa Accuracy: 0.821 ± 0.008 for Pleiades & 0.792 ± 0.005 for Sentinel-2 10 m). Likewise, model specificity and sensitivity showed the greatest values from 8 spectral bands and above, but no increase was shown from 10 to 300 bands (Sensitivity: 0.948 ± 0.006 for Sentinel-2 20 m, 0.941 ± 0.006 for Drone, ± 0.006 for PRISMA & 0.938 ± 0.008 for ASD; Specificity: 0.989 ± 0.001 for Sentinel-2 20 m, 0.989 ± 0.001 for Drone, ± 0.001 for PRISMA & 0.989 ± 0.001 for ASD). Below 8 spectral bands, mean sensitivity and specificity were lowest, yet still around 85% (Sensitivity: 0.847 ± 0.008 for Pleiades & 0.844 ± 0.008 for Sentinel-2 10 m; Specificity: 0.97 ± 0.001 for Pleiades & 0.966 ± 0.002 for Sentinel-2 10 m). Standardised variable importance, the relative amount the inclusion of a variable in the model affected its’ performance, showed the wavelengths the model considered most important (@fig-VIPFIG). Consistently across all spectral resolutions, wavelengths 517–556 nm were shown to be highly important. When present, wavelengths around 722–754 nm were the most important. When the variable importance of the ASD was overlaid on the response functions for the different multispectral sensors, the ability of each sensor to effectively sample the wavelengths of interest become clearer (@fig-VIPFunction). The Drone and Pleiades sensors effectively sample the top of the peak in importance from 517 to 556 nm, while Sentinel-2 (10 m and 20 m) is only sampling the edges of the peak. Both Pleiades and Sentinel-2 at 10 m did not sample the highest peak of importance from 722 to 754 nm, while the Drone and Sentinel-2 at 20 m only sampled one side of this peak. Generally, the Drone is sampling all the major and minor peaks of importance apart from one minor peak around 780 nm.

```{r Combo_Metrics_Plot}
#| label: fig-MetricsFIG
#| fig-cap: " Accuracy metrics (accuracy, Cohen's kappa accuracy, sensitivity and specificity) for different spectral resolutions."
#| fig.width: 9.97
#| fig.height: 10
#| out-width: "95%"
#| error: false
#| warning: false
#| echo: false


knitr::include_graphics("Figs/Figure6_Bede.jpg")

```

```{r Metricstab}
#| label: tbl-metricsTable
#| tbl-cap: >
#|    Accuracy metrics (accuracy, Cohen's kappa accuracy, sensitivity and specificity) for different spectral resolutions ± standard error.
#| echo: false
#| error: false
#| message: false
#| warning: false
#| out-width: "95%"


library(flextable)

# Create the dataframe
df <- data.frame(
  Sensor = c("Sentinel-2 10m (4 bands)", "Pleiades (4 bands)", "Sentinel-2 20m (8 bands)", 
             "Drone (10 bands)", "PRISMA (56 bands)", "ASD (335 bands)"),
  Accuracy = c("83.5±0.76", "86.1±0.61", "95.2±0.44", "94.8±0.42", "95.1±0.61", "95.2±0.48"),
  Cohens_Kappa = c("0.792±0.0096", "0.821±0.00773", "0.935±0.00577", "0.934±0.00535", "0.938±0.00778", "0.936±0.00624"),
  Sensitivity = c("84.4±0.81", "84.7±0.76", "94.8±0.57", "94.1±0.62", "94.7±0.6", "93.8±0.75"),
  Specificity = c("96.6±0.16", "97±0.13", "98.9±0.1", "98.9±0.09", "99±0.13", "98.9±0.11")
)

# Create a flextable
ft <- flextable(df)

# Add header style
ft <- set_header_labels(ft, 
                        Sensor = "Sensor", 
                        Accuracy = "Accuracy", 
                        Cohens_Kappa = "Cohen's Kappa", 
                        Sensitivity = "Sensitivity", 
                        Specificity = "Specificity")

# Style the flextable
# ft <- theme_vanilla(ft) # Apply a clean theme
ft <- autofit(ft) # Autofit column widths
ft <- align(ft, align = "center", part = "all") # Center align text
ft <- bold(ft, part = "header") # Bold the header

# Display the flextable
# save_as_image(ft, path = "Manuscript/Chapter1/Figs/metricsTable.png")

knitr::include_graphics("Figs/metricsTable.png")

```
Standardised variable importance, the relative amount the inclusion of a variable in the model affected its' performance, showed the wavelengths the model considered most important (@fig-VIPFIG). Consistently across all spectral resolutions, wavelengths 517–556 nm were shown to be highly important. When present, wavelengths around 722–754 nm were the most important.

```{r Combo_Variable_Importance_Plot}
#| label: fig-VIPFIG
#| fig-cap: " The relative importance of different wavelengths for model prediction across spectral resolutions."
#| fig.width: 10
#| fig.height: 9.87
#| out-width: "95%"
#| error: false
#| warning: false
#| echo: false

knitr::include_graphics("Figs/Figure7_Bede.jpg")
 
```

When the variable importance of the ASD was overlaid on the response functions for the different multispectral sensors, the ability of each sensor to effectively sample the wavelengths of interest become clearer (Fig. 8). The Drone and Pleiades sensors effectively sample the top of the peak in importance from 517 to 556 nm, while Sentinel-2 (10 m and 20 m) is only sampling the edges of the peak. Both Pleiades and Sentinel-2 at 10 m did not sample the highest peak of importance from 722 to 754 nm, while the Drone and Sentinel-2 at 20 m only sampled one side of this peak. Generally, the Drone is sampling all the major and minor peaks of importance apart from one minor peak around 780 nm.

```{r Combo_VIPASD_ResponseFunctions}
#| label: fig-VIPFunction
#| fig-cap: " The relative importance of different wavelengths for ASD model prediction across the spectral bands of the Drone, Sentinel-2 and Pleiades sensors."
#| fig.width: 10
#| fig.height: 9.89
#| out-width: "95%"
#| error: false
#| warning: false
#| echo: false

knitr::include_graphics("Figs/Figure8_Bede.jpg")


```

### Confusion Matrices

Models accurately classed bare sediments consistently, regardless of spectral resolution (@fig-ConfMatFIG). Ulvophyceae appeared to be mislabeled the most, while Magnoliopsida and Phaeophyceae showed consistently high prediction accuracy, especially by the Drone data. Across all spectral resolutions a small number of Magnoliopsida samples were mislabeled as Bacilliariophyceae, Xanthophyceae and Ulvophyceae. A few Bacilliariophyceae and Ulvophyceae samples were incorrectly labeled as Magnoliopsida. Likewise, identification of Xanthophyceae was consistenetly poor across all spectral resolutions apart from Sentinel-2 at 20 m (Sensitivity: 0.79 ASD, 0.87 PRISMA, 0.76 Drone, 0.93 Sentinel-2 at 20 m, 0.7 Sentinel-2 at 10 m and 0.5 Pleiades and Specificity: 0.84 ASD, 0.84 PRISMA, 0.86 Drone, 0.82 Sentinel-2 at 20 m, 0.57 Sentinel-2 at 10 m and 0.53 Pleiades). Pleiades and Sentinel-2 at 10 m had the worst Magnoliopsida classification (Sensitivity: 0.66 Sentinel-2 at 10 m and 0.75 Pleiades; Specificity: 0.79 Sentinel-2 at 10 m and 0.8 Pleiades).

```{r Conf_Mat_Plot}
#| label: fig-ConfMatFIG
#| fig-cap: " Confusion matrices for different spectral resolutions. Colour of tiles show proportion of correct predictions across all 20 repetitions with no colour for 0 predictions. Classes were abbreviated Bacillariophyceae as Bac, Bare Sediments as Bar, Magnoliopsida as Mag, Phaeophyceae as Pha and Ulvophyceae as Ulv. Labels with numbers show within class sensitivity and specificity."
#| tbl-cap: .
#| fig.width: 10
#| fig.height: 10
#| out-width: "95%"
#| error: false
#| warning: false
#| echo: false

knitr::include_graphics("Figs/Figure9_Bede.jpg")

```

## Discussion

### Spectral Library and Vegetation Classification

Spectral libraries have been used in coastal areas to analyse the capacity of hyperspectral sensors to discriminate macrophytes at different taxonomic resolutions [@rs11060704; @douay2022new;@rs14133124; for earlier references see @ChaoRodriguez2017] or to estimate the background contribution on benthic diatoms reflectance spectra [@Barille2011]. The spectral library built up for this work was used to study the discriminatory ability of exposed soft-bottom intertidal vegetation at a class taxonomic level for a variety of remote-sensing instruments. Importantly, the classifier was designed to be applicable to both multi- and hyperspectral sensors, which is an advantage compared to classification methods only designed for hyperspectral sensors, such as derivative spectral analysis [@rs11060704]. The discrimination accuracy of the vegetation classes increased with spectral resolution, yet showed diminishing returns for resolutions above ~10 spectral bands. The main result of this study was the capacity to discriminate seagrass from green macroalgae at a multispectral resolution with ten bands when using ML classification techniques. As expected, this discrimination was also possible with hyperspectral sensors. Sensors with a spectral resolution of four bands, such as Pleiades and Sentinel 2 (10 m), were poorer at accurately discriminating between green macroalgae and seagrass, as their spectral shapes were too similar (@fig-SpectraFIG & @fig-MetricsFIG). The importance of effective seagrass classification is considerable, with seagrass conservation and restoration contributing to 16 of the 17 United Nations Sustainable Development Goals [SDGs: @Unsworth2022]. A practical restraint of this analysis is the necessity for non-submerged samples. However, the main challenge in mapping seagrass through RS stems from confusion between similarly pigmented green algae, leading to high levels of uncertainty in current seagrass extent [@mckenzie2020global]. Vegetation classes were consistently distinguishable from bare sediments, as found elsewhere between bare rock and algae [@douay2022new]. Likewise, random forest models were successfully able to discriminate between habitats [See also: @oiry2021using;@legare2022remote], with generally lower accuracy at lower spectral resolution, yet even at the lowest spectral resolutions (Pleiades and Sentinel-2 10 m) there was a mean test accuracy of 86.1% and 83.5% respectively (82.1% and 79.2% respectively when class imbalance was considered with Cohen's kappa).

### Spectral Discrimination and Pigment Composition

Two wavelength regions, respectively in the green (~517–556 nm) and NIR (~722–754 nm) spectral domains, were identified for their importance to the random forest model as contributing most to the discrimination between taxonomic classes (@fig-VIPFIG). The wavelength window around 530 nm has already been recommended to distinguish different species of seagrass [@fyfe2003spatial], and brown from green macroalgae [@rs11060704]. The spectral differences in the visible range between the classes are partially explained by their difference of pigment composition (@tbl-pigmentTable). Pigments have different optical properties and absorption wavelengths, which influence the reflectance spectra shapes. Chlc and fucoxanthin absorb light at 636 nm and 550 nm respectively [@Meleder2013]. Those pigments are present amongst diatoms and brown macroalgae, but absent in green macrophytes. Xanthophyceae also contain Chlc, but no fucoxanthin (@tbl-pigmentTable). Chlorophylls and carotenoids absorptions can thus be used as diagnostic features to identify vegetation types that do not share the same pigmentary composition [@Casal2012; @douay2022new; @Meleder2013]. In this work, spectral differences have been observed between two classes having a similar pigment composition, the Magnoliopsida and the Ulvophyceae (@tbl-pigmentTable). This indicates that the pigment concentrations and relative proportions, which can vary inside the main vegetation groups [@Bargain2013; @beach1997vivo], contribute to the spectral discrimination between taxonomic classes sharing the same pigment composition. Variations in the configuration of photosynthetic and accessory pigments in the 3D pigment-protein complexes within cells can also change the absorption features of taxa sharing the same pigments [@Kirk1994], while 3D disposition of the plants as a whole can alter the magnitude of reflectance [@Hedley2018]. As pigment absorptions correspond to narrow spectral bands [@Meleder2013; @douay2022new], discriminating the different types of intertidal vegetation relies on access to these specific absorption wavelengths, which explains why the hyperspectral sensors are generally more accurate than the multispectral sensors. For the latter, the lack of relevant spectral bands and the large width of the available ones does not permit to capture the diagnostic absorption features. NIR wavelengths have long been recognized as relevant for the spectral discrimination of terrestrial plant diversity [@Schmidt2003]. At these wavelengths, spectral signatures are mainly a function of light scattering determined by the internal structure of leaves for angiosperms or thallus for macroalgae [@Guyot1990]. @fyfe2003spatial showed that seagrass species could be separated using NIR wavelengths, with a significant change in the slopes between 700 and 900 nm. In our study, the min-max standardization preserved the slope changes for this spectral domain while removing the difference related to biomass variations [@Bargain2012].  Within the NIR, the ~722-754 nm wavelength range was identified in our work as the most discriminant for the spectral separation of the taxonomic classes of intertidal macrophytes.  The better results obtained with the Drone and Sentinel-2 (20 m) bands suggest that a multispectral sensor with 10 relevant VNIR spectral bands could discriminate the main classes considered in this study. Furthermore, the wavelengths of importance for distinguishing the taxonomic classes here showed that the sensor used by Sentinel-2 could be greatly improved by the inclusion of a band at the main peaks of importance  (∼517–556 nm and ∼ 722–754 nm). Both Pleiades and Sentinel-2 at 10 m miss the the peak of highest importance. Furthermore, the marginally higher performance of the Pleiades sensor compared to that of the Sentinel-2 at 10 m could be linked to the overlap of two Pleiades bands over the ∼517–556 nm peak, while Sentinel-2 at 10 m only has bands either side of this peak. Thus, future satellite missions aiming to provide information on global habitat cover, especially including intertidal habitats, should aim to provide sensors with spectral patterns that cover the important wavelengths shown here. @Dekker2018 highlighted the utility multispectral sensors could have for monitoring a wide range of aquatic systems, recommending ~26 bands between 380 and 780 nm, specifically 684 nm to capture Chla fluorescence. From the current analysis focusing on intertidal habitats, the most important wavelengths to cover would be around  530 & 730 nm. The main reason for this difference with the recommendations of @Dekker2018 is that their work was specifically focused on submerged vegetation and addressed a broader range of objectives. For an effective monitoring system, specific and broad objectives of the satellite will ideally dictate the spectral coverage of the sensors used. 

```{r Pigments}
#| label: tbl-pigmentTable
#| tbl-cap: >
#|    Photosynthetic and carotenoid pigments present (1) or absent (0) in each taxonomic class, along with their absorption wavelength measured in vivo and in vitro with an ASD spectroradiometer and by High Performance Liquid
#|    Chromatography (HPLC) respectively. Chl b: chlorophyll b, Chl c: chlorophyll c, Fuco: fucoxanthin, Zea: zeaxanthin, Diato: diatoxanthin, Diadino: diadinoxanthin, Neo: neoxanthin. 
#| echo: false
#| error: false
#| message: false
#| warning: false
#| out-width: "95%"

library()

PigTable<-tibble::tribble(
  ~Class,	~`Chl b`, ~`Chl c`,	~Fuco,	~Zea,	~Diato,	~Diadino, ~Neo,	~Lutein,	~Source,
"Magnoliopsida",	"1",	"0",	"0",	"1",	"0",	"0",	"1",	"1",	"Ralph et al., 2002",
"Ulvophyceae",	"1",	"0",	"0",	"1",	"0",	"0",	"1",	"1",	"Douay et al., 2022",
"Xanthophyceae",	"0",	"1",	"0",	"1",	"1",	"1",	"0",	"0",	"Christensen et al., 1977",
"Phaeophyceae",	"0",	"1",	"1",	"1",	"0",	"0",	"0",	"0",	"Douay et al., 2022",
"Bacillariophyceae",	"0",	"1",	"1",	"0",	"1",	"1",	"0",	"0",	"Cartaxana et al., 2016",
"Absorption wavelength (ASD)",	"650",	"636",	"550",	"489",	"496",	"496",	"-",	"500",	"Méléder et al., 2013",
"Absorption wavelength (HPLC)", "458, 
596, 
646",
"442,
573,
630",
"451,
465",
"452,
478",
"453,
481",
"420,
447,
477",
"414,
437,
466",
"421,
446,
474",	"Méléder et al., 2013")

flxtable <- PigTable %>% 
  flextable::flextable()%>% 
  flextable::fontsize(size = 16, part = "header") %>%
  flextable::fontsize(size = 13) %>%
  flextable::align(align = "center", part = "body") %>%   # Center body text
  flextable::align(align = "center", part = "header") %>% # Center header text
  # flextable::width(width = 0.5) %>% # Set narrower columns
  # flextable::autofit() 
  flextable::set_table_properties(layout = "autofit")

# flextable::save_as_image(flxtable, path = "Manuscript/Chapter2/Figs/pigmentTable.png")
# flxtable
knitr::include_graphics("Figs/pigmentTable.png")


```


### Geographical and Temporal Range of Applicability

The present spectral library aimed to represent a diversity of soft-bottom intertidal vegetation, with the main objective of discriminating seagrass from green macroalgae. However, it has a greater diversity of green macrophytes, making unbalanced among classes. Green macroalgae represent around 33% % of the library with 121 spectra out of 366, while the yellow macroalgae only have 33 spectra. Such a difference has an impact on the statistical analysis and the discrimination results, as some species are over-represented and others underrepresented. Yet, use of Cohen's kappa, which is an accuracy metric taking into consideration this imbalance, gave minimal difference to global accuracy. This library was built with data collected on the Atlantic coasts of France, Spain and Portugal and could be improved by the addition of new species or spectra from the existing species from other sites, both across Europe and globally.

As advised by @Bajjouk2019, *Z. noltei* spectral data were collected at their development peak (June to September), as it is known that these macrophytes have a seasonal pigment variation [@Bargain2013]. Likewise, @legare2022remote found that depending on the season, spectral reflectance from intertidal habitats can vary significantly. As such, the current spectral library should not be used outside a late spring and summer period for Western Europe, as the varying pigment content can affect the reflectance spectral shapes. Seagrass spectral analysis could also be refined by taking into account the presence of epiphytes on their leaves, which was not done in this study. Epiphytes on seagrass leaves are known to have an impact on the shape of the reflectance spectra [@fyfe2003spatial], as they are composed of diatoms and brown algae. This might explain the proximity between some seagrass and brown macroalgae spectra and the overlap between the diatoms and the seagrass (@fig-MDSFIG). The presence of epiphytes could alter the relevance of the most discriminative wavelengths between seagrass and other macroalgae. Furthermore, this library was created using 100% cover of taxonomic classes. This homogeneity is often rare at the satellite pixel scales (10 - 60 m), meaning future work should assess the spectral signatures of mixed intertidal vegetation to best predict extent of heterogeneous intertidal vegetation.

### Implications for Coastal Biodiversity Studies

The importance of long term monitoring of ecosystems is becoming more acknowledged, especially when monitoring human impacts that may affect EBVs, such as important habitats, species, or the functioning of those species or habitats [@Lengyel2008;@Perera2020;@Livore2021;@Davies2021a;@Davies2022a;@El2020]. This is becoming even more apparent with the acceleration of human induced climate change, which is likely to exacerbate or accelerate the effects of many other human impacts [@Cramer2018;@Sage2020]. Yet, *in situ* long term monitoring of EBVs is rare [@Edwards2010]. This rarity is due to a range of factors, most of which are driven by financial cost, especially if multiple fieldwork campaigns per year are required to capture seasonal variation [@Condal2012]. Furthermore, many human impacts can rarely be predicted *a priori*, so the ability to monitor their impact with sufficient previous data is circumstantial [@Sheehan2021;@Davies2022b]. This prior data is imperative to properly monitor human impacts and subsequently manage the activities leading to those impacts appropriately [@Underwood1992;@Fox2017;@Edgar2004]. The extent, both temporally and spatially, of EO from satellite data alongside its accessibility means it has been used to study long term anthropogenic impacts [@Hu2017; @Santos2020; @Lizcano2022; @zoffoli2021decadal]. Unlike *in situ* monitoring data, past EO data are easily available, meaning that the long term manifestation of novel phenomena can be assessed effectively [@Mahrad2020]. Here, it was shown that spectral reflectance measurements from a relatively low spectral resolution sensor (8-10 bands: e.g. sensor of Sentinel-2 at 20 m resolution) could effectively and accurately classify soft-bottom intertidal vegetative habitats. However, the importance of spectral coverage has also been highlighted; when EO is being utilised, the specific response functions of sensors need to be aligned effectively with the objectives of the analysis. These considerations, alongside the temporal and spatial scales; revisit times of satellites, and the ability for satellites sensors to effectively observe important spectral differences after atmospheric correction is applied, will dictate the most appropriate satellites to be included in a Global Ocean Observing System (GOOS) for optimal monitoring and understanding of the EOVs in coastal ecosystems studies.

### Conclusions

Here, the ability to distinguish between five different vegetative intertidal habitats was assessed by analysing their spectral reflectance signatures. Around 366 spectra were compiled across the European Atlantic coast, from Southern Spain to Northern France. The spectral library was analysed at different multi- and hyperspectral resolutions with the emphasis on comparing commonly used satellite and drone sensors. This analysis not only highlighted the ability of a random forest spectral classification model to distinguish between differently pigmented habitats but also between similarly pigmented classes (green algae and seagrass). This approach could aid with ongoing efforts to accurately estimate global seagrass extent, alongside common methods such as NDVI that can provide proxies for vegetation coverage, such as monospecific intertidal seagrass meadow [@zoffoli2020sentinel]. In particular, our work demonstrated the potential of discriminating intertidal seagrass from Ulvophyceae using satellite RS, therefore unlocking a strong limitation for seagrass mapping in heterogeneous environments. High accuracy at distinguishing habitats was found for hyperspectral sensors as well as multispectral sensors consisting of >8 bands in the visible and NIR (ASD, PRISMA, Sentinel-2 at 20 m resolution and the MicaSense RedEdge MX-dual Drone sensor). As climate change alongside other anthropogenic activities continue to impact community stability and functions, and potentially altering ecosystem services, monitoring of habitats becomes ever more important. Intertidal habitats are a vital link between terrestrial and coastal marine ecosystems, yet due to their dynamic nature and inaccessibility are difficult to assess. Therefore, the ability to monitor these ecosystems over time with high spatial and temporal resolution is important. This research provides the evidence that soft-bottom intertidal green macrophytes can be accurately classified at spectral resolutions currently available from satellite missions, assuming consistency after atmospheric correction, thus offering new perspectives for EO biodiversity studies of intertidal ecosystems. It further provides advice for the next generation of satellite missions in terms of optimal spectral resolution and important wavelengths.


```{=latex}
\end{spacing}
```

```{=latex}
\renewcommand{\chaptertopimage}{Chapter3/img/top.png}
\renewcommand{\chapterbottomimage}{Chapter3/img/bottom.png}
```

```{=latex}
\newpage\null\thispagestyle{empty}\newpage
```


